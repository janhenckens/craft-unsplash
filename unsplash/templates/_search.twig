{% extends '_layouts/cp' %}
{% set title = "Search - Unsplash"|t %}

{% set tabs = {
    popular: { label: "Popular"|t, url: url('unsplash')},
    latest: { label: "Last Added"|t, url: url('unsplash/latest') },
    random: { label: "Random"|t, url: url('unsplash/random')},
    search: { label: "Search"|t, url: url('unsplash/search')},
} %}
{% set selectedTab = 'search' %}

{% set extraPageHeaderHtml %}
    {% include 'unsplash/components/_searchForm' %}
{% endset %}

{% set content %}
    {% if results.images|length %}
    <div class="wrapper" id="splashing-images">
        {% set downloadIcon = resourceUrl('unsplash/download.svg') %}

        {% for image in results.images %}
            {% set thumb = image.urls.thumb %}
            {% set download= image.links.download %}
            {% set author = image.user.name %}
            {% set profileUrl = image.user.links.html %}

            <div class="upload">
                <div class="image">
                <a href="" class="splashing-image" data-source="{{ download }}" data-author="{{ author }}">
                    <img class="splashing-thumbnail ms-item" src="{{ thumb }}" alt="{{ author }}">
                </a>
                </div>
                <div class="credit">
                    <a href="{{ profileUrl }}?utm_source=SplashingImages_CraftCMS" target="_blank" class="credit__author">{{ 'by'|t }} {{ author }}</a>
                </div>
            </div>
        {% endfor %}
    </div>
    <hr>

    {{ results.pagination.total_results }} {{ 'results found for'|t }} {{ craft.request.getParam('q') }}.
    {% set currentPage =  craft.request.getParam('page') %}
    {% if currentPage != 1 %}

    <a href="{{ url('/admin/unsplash/search', { 'q' : craft.request.getParam('q'), 'page' : '1'}) }}">{{ 'First'|t }}</a> |
    <a href="{{ url('/admin/unsplash/search', { 'q' : craft.request.getParam('q'), 'page' : currentPage-1}) }}">{{ 'Previous'|t }}</a> |
    {% endif %}
    {{ 'Page'|t }} {{ currentPage }}
    {% if currentPage != results.pagination.total_pages %}
    | <a href="{{ url('/admin/unsplash/search', { 'q' : craft.request.getParam('q'), 'page' : currentPage+1}) }}">{{ 'Next'|t }}</a> |
    <a href="{{ url('/admin/unsplash/search', { 'q' : craft.request.getParam('q'), 'page' : results.pagination.total_pages }) }}">{{ 'Last'|t }}</a>
    {% endif %}

    <script type="text/javascript">
        window.csrfTokenName = "{{ craft.config.get('csrfTokenName') }}";
        window.csrfTokenValue = "{{ craft.request.getCsrfToken }}";
    </script>


    {% set masonry %}
        $( document ).ready(function() {
            var $grid = jQuery('#splashing-images').masonry({
            itemSelector: 'div.upload',
            gutter: 10,
        });
        $grid.imagesLoaded().progress( function() {
            $grid.masonry('layout');
            });
        });
    {% endset %}

    {% includeJs masonry %}
    {% includeCssResource "unsplash/css/splashingimages.css" %}
    {% includeJsResource "unsplash/js/jquery-3.2.1.min.js" %}
    {% includeJsResource "unsplash/js/splashingimages.js" %}
    {% includeJsResource "unsplash/js/loadingoverlay.min.js" %}
    {% includeJsResource "unsplash/js/imagesloaded.pkgd.min.js" %}
    {% includeJsResource "unsplash/js/masonry.pkgd.min.js" %}
    {% else %}
        {{ 'No results found for'|t }} <strong>{{ craft.request.getParam('q') }}</strong>.
    {% endif %}
{% endset %}
